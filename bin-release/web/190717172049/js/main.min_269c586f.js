var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,a){function i(e){try{h(r.next(e))}catch(t){a(t)}}function o(e){try{h(r["throw"](e))}catch(t){a(t)}}function h(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(i,o)}h((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(s)throw new TypeError("Generator is already executing.");for(;h;)try{if(s=1,a&&(i=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(i=i.call(a,n[1])).done)return i;switch(a=0,i&&(n=[0,i.value]),n[0]){case 0:case 1:i=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,a=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(i=h.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){h=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){h.label=n[1];break}if(6===n[0]&&h.label<i[1]){h.label=i[1],i=n;break}if(i&&h.label<i[2]){h.label=i[2],h.ops.push(n);break}i[2]&&h.ops.pop(),h.trys.pop();continue}n=t.call(e,h)}catch(r){n=[6,r],a=0}finally{s=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var s,a,i,o,h={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},LeafShape=function(e){function t(t){var n=e.call(this)||this;return n._speedX=0,n._speedY=0,n._isUse=!1,n._parent=t,n.width=50,n.height=35,n}return __extends(t,e),t.prototype.Fly=function(){this.isUse&&(this.x+=this._speedX,this.y+=this._speedY,(this.x>=this._parent.stageW||this.y>=this._parent.stageH)&&this.Recycle())},t.prototype.Use=function(e){switch(this._isUse=!0,this._type=e,e){case MyDefine.enLeafType.enType_yellow:this.texture=RES.getRes("yellow_leaf");break;case MyDefine.enLeafType.enType_green:this.texture=RES.getRes("green_leaf");break;case MyDefine.enLeafType.enType_red:this.texture=RES.getRes("red_leaf")}this._speedX=12*Math.random()+6,this._speedY=4*Math.random()+1,this.x=-(this._parent.stageW+10),this.y=Math.random()*this._parent.stageH/3+50,this._parent.addChild(this),this.addEventListener(egret.Event.ENTER_FRAME,this.Fly,this)},t.prototype.Recycle=function(){switch(this._isUse=!1,this._type){case MyDefine.enLeafType.enType_yellow:0==this._parent.yellowLeafsArr.length?this._parent.yellowLeafsArr.length=0:this._parent.yellowLeafsArr.length--;break;case MyDefine.enLeafType.enType_red:0==this._parent.redLeafsArr.length?this._parent.redLeafsArr.length=0:this._parent.redLeafsArr.length--;break;case MyDefine.enLeafType.enType_green:0==this._parent.greenLeafsArr.length?this._parent.greenLeafsArr.length=0:this._parent.greenLeafsArr.length--}this.removeEventListener(egret.Event.ENTER_FRAME,this.Fly,this),this._parent.removeChild(this)},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUse",{get:function(){return this._isUse},enumerable:!0,configurable:!0}),t}(egret.Bitmap);__reflect(LeafShape.prototype,"LeafShape");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function r(r){t.call(n,r,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?r(s):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var GameManager=function(e){function t(){var n=e.call(this)||this;return n.mSceneType=MyDefine.enSceneType.enScene_Lobby,t._instance=n,n}return __extends(t,e),t.GetInstance=function(){return t._instance},t.prototype.start=function(){this.gameLobby=new GameLobby,this.addChild(this.gameLobby),this.gameLobby.Start()},t.prototype.SetSceneType=function(e){this.mSceneType=e},t.prototype.ChangeScene=function(e){switch(this.SetSceneType(e),e){case 0:this.gameResult&&this.gameResult.parent&&(this.gameResult.End(),this.removeChild(this.gameResult),this.gameLobby=new GameLobby,this.addChild(this.gameLobby),this.gameLobby.Start());break;case 1:this.gameLobby&&this.gameLobby.parent&&(this.gameLobby.End(),this.removeChild(this.gameLobby),this.gameScene=new GameScene,this.addChild(this.gameScene),this.gameScene.Start());break;case 2:this.gameScene&&this.gameScene.parent&&(this.gameScene.End(),this.removeChild(this.gameScene),this.gameResult=new GameResult,this.addChild(this.gameResult),this.gameResult.Start())}},t}(egret.Sprite);__reflect(GameManager.prototype,"GameManager");var GameResult=function(e){function t(){var n=e.call(this)||this;return t._instance=n,n.skinName="resource/skins/GameResult.exml",n}return __extends(t,e),t.GetInstance=function(){return t._instance},t.prototype.Start=function(){this.once(egret.TouchEvent.TOUCH_TAP,this.GameBeginHandler,this),egret.Tween.get(this.leaf1,{loop:!0}).to({x:640,y:400},2200,egret.Ease.quadIn).wait(1e3),egret.Tween.get(this.leaf2,{loop:!0}).to({x:640,y:500},3e3,egret.Ease.quadIn).wait(1e3),egret.Tween.get(this.leaf3,{loop:!0}).to({x:640,y:550},2500,egret.Ease.quadIn).wait(1e3),egret.Tween.get(this.leaf4,{loop:!0}).to({x:640,y:600},1800,egret.Ease.quadIn).wait(1e3),egret.Tween.get(this.leaf5,{loop:!0}).to({x:640,y:450},2e3,egret.Ease.quadIn).wait(1e3),this.yellowCounts.text=egret.localStorage.getItem("yellowNumbers"),this.greenCounts.text=egret.localStorage.getItem("greenNumbers"),this.bestScore.text=egret.localStorage.getItem("bestScore"),this.AutoResizeText(this.bestScoreLabel);var e=RES.getRes("grass_json"),t=RES.getRes("grass_png"),n=new egret.MovieClipDataFactory(e,t);this.mc=new egret.MovieClip(n.generateMovieClipData("grass")),this.mc.width=this.stage.stageWidth,this.mc.x=-10,this.mc.y=this.stage.stageHeight-this.mc.height,this.addChild(this.mc),this.mc.gotoAndPlay(1,-1)},t.prototype.GameBeginHandler=function(){GameManager.GetInstance().ChangeScene(MyDefine.enSceneType.enScene_Lobby)},t.prototype.End=function(){this.mc.stop(),egret.Tween.removeTweens(this.leaf1),egret.Tween.removeTweens(this.leaf2),egret.Tween.removeTweens(this.leaf3),egret.Tween.removeTweens(this.leaf4),egret.Tween.removeTweens(this.leaf5)},t.prototype.AutoResizeText=function(e){for(;e.size>10&&e.width>e.parent.width;)e.size-=2},t}(eui.Component);__reflect(GameResult.prototype,"GameResult");var GameScene=function(e){function t(){var t=e.call(this)||this;return t.touchState=MyDefine.enTouchState.enTouch_Undo,t.maxYellowLeafsNumber=6,t.maxRedLeafsNumber=3,t.maxGreenLeafsNumber=3,t.yellowNumbers=0,t.greenNumbers=0,t.skinName="resource/skins/GameScene.exml",t.sound_1=RES.getRes("1_mp3"),t.sound_2=RES.getRes("2_mp3"),t.sound_3=RES.getRes("3_mp3"),t.sound_4=RES.getRes("4_mp3"),t}return __extends(t,e),t.GetInstance=function(){return t._instance},t.prototype.Start=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.myLeaf=new egret.Bitmap,this.myLeaf.texture=RES.getRes("green_leaf"),this.myLeaf.width=50,this.myLeaf.height=35,this.myLeaf.x=this.stageW/2,this.myLeaf.y=this.stageH/2,this.addChild(this.myLeaf),this.yellowLeafsArr=new Array,this.greenLeafsArr=new Array,this.redLeafsArr=new Array,this.leafArr=new Array,this.myLeafRect=this.myLeaf.getBounds(),this.yellowCounts.text=this.yellowNumbers+"",this.greenCounts.text=this.greenNumbers+"",this.addEventListener(egret.Event.ENTER_FRAME,this.Update,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.LeafUp,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.LeafDown,this);var e=RES.getRes("grass_json"),t=RES.getRes("grass_png"),n=new egret.MovieClipDataFactory(e,t);this.mc1=new egret.MovieClip(n.generateMovieClipData("grass")),this.mc2=new egret.MovieClip(n.generateMovieClipData("grass")),this.mc1.width=this.stageW,this.mc1.x=-10,this.mc1.y=this.stageH-this.mc1.height,this.mc2.width=this.stageW,this.mc2.x=-this.stageW,this.mc2.y=this.stageH-this.mc2.height,this.addChild(this.mc1),this.addChild(this.mc2),this.mc1.gotoAndPlay(1,-1),this.mc2.gotoAndPlay(1,-1),this.InitPool(),this.CreateLeafs(),this.myLeafRect=this.myLeaf.getBounds()},t.prototype.Update=function(){var e=this;switch(this.BackgroundMove(),this.touchState){case MyDefine.enTouchState.enTouch_Touching:this.myLeaf.y=this.myLeaf.y<=0?0:this.myLeaf.y-8,this.myLeaf.x=this.myLeaf.x<=0?0:this.myLeaf.x;break;default:this.myLeaf.y+=10,this.myLeaf.x=this.myLeaf.x<=0?0:this.myLeaf.x}for(var t=0;t<this.leafArr.length;t++){this.myLeafRect.x=this.myLeaf.x,this.myLeafRect.y=this.myLeaf.y;var n=this.leafArr[t],r=n.getBounds();if(r.x=n.x,r.y=n.y,n.isUse&&this.myLeafRect.intersects(r))switch(this.PlaySound(),n.type){case MyDefine.enLeafType.enType_yellow:this.yellowNumbers++,this.yellowCounts.text=this.yellowNumbers+"",this.leafArr[t].Recycle();break;case MyDefine.enLeafType.enType_red:var s=this.myLeaf.x+40;this.leafArr[t].Recycle(),egret.Tween.get(this.myLeaf).to({alpha:.5,x:s},300).to({alpha:1},300).call(function(){egret.Tween.removeTweens(e.myLeaf)});break;case MyDefine.enLeafType.enType_green:var s=this.myLeaf.x-40;this.greenNumbers++,this.greenCounts.text=this.greenNumbers+"",this.leafArr[t].Recycle(),egret.Tween.get(this.myLeaf).to({x:s,rotation:360},500).call(function(){egret.Tween.removeTweens(e.myLeaf)})}}return this.CreateLeafs(),this.myLeaf.x>=this.stageW||this.myLeaf.y>=this.stageH-this.myLeaf.height?void this.GameOver():void 0},t.prototype.PlaySound=function(){var e=Math.ceil(4*Math.random());switch(e){case 1:this.sound_1.play(0,1);break;case 2:this.sound_2.play(0,1);break;case 3:this.sound_3.play(0,1);break;case 4:this.sound_4.play(0,1)}},t.prototype.CreateLeafs=function(){for(var e=0==this.yellowLeafsArr.length?Math.floor(Math.random()*this.maxYellowLeafsNumber+1):Math.floor(Math.random()*(this.maxYellowLeafsNumber-this.yellowLeafsArr.length)),t=0;e>t;t++){var n=this.GetLeaf();if(void 0==n)return;n.Use(MyDefine.enLeafType.enType_yellow),this.yellowLeafsArr.push(n)}for(var r=0==this.redLeafsArr.length?Math.floor(Math.random()*this.maxRedLeafsNumber+1):Math.floor(Math.random()*(this.maxRedLeafsNumber-this.redLeafsArr.length)),t=0;r>t;t++){var n=this.GetLeaf();if(void 0==n)return;n.Use(MyDefine.enLeafType.enType_red),this.redLeafsArr.push(n)}for(var s=0==this.greenLeafsArr.length?Math.floor(Math.random()*this.maxGreenLeafsNumber+1):Math.floor(Math.random()*(this.maxGreenLeafsNumber-this.greenLeafsArr.length)),t=0;s>t;t++){var n=this.GetLeaf();if(void 0==n)return;n.Use(MyDefine.enLeafType.enType_green),this.greenLeafsArr.push(n)}},t.prototype.LeafUp=function(){this.touchState=MyDefine.enTouchState.enTouch_Touching},t.prototype.LeafDown=function(){this.touchState=MyDefine.enTouchState.enTouch_End},t.prototype.BackgroundMove=function(){this.mc1.x+=5,this.mc2.x+=5,this.mc1.x>=this.stage.stageWidth&&(this.mc1.x=this.mc2.x-this.mc2.width),this.mc2.x>=this.stage.stageWidth&&(this.mc2.x=this.mc1.x-this.mc1.width)},t.prototype.GameOver=function(){egret.localStorage.setItem("yellowNumbers",this.yellowNumbers+""),egret.localStorage.setItem("greenNumbers",this.greenNumbers+"");var e=egret.localStorage.getItem("bestScore");void 0==e&&(e="0"),e=parseInt(e)>this.yellowNumbers?e:this.yellowNumbers+"",egret.localStorage.setItem("bestScore",e),GameManager.GetInstance().ChangeScene(MyDefine.enSceneType.enScene_Result)},t.prototype.End=function(){this.mc1.stop(),this.mc2.stop(),this.removeEventListener(egret.Event.ENTER_FRAME,this.Update,this),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.LeafUp,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.LeafDown,this)},t.prototype.InitPool=function(){for(var e=0;12>e;e++){var t=new LeafShape(this);this.leafArr.push(t)}},t.prototype.GetLeaf=function(){for(var e=0,t=this.leafArr.length;t>e;e++)if(0==this.leafArr[e].isUse)return this.leafArr[e]},t}(eui.Component);__reflect(GameScene.prototype,"GameScene");var GameLobby=function(e){function t(){var n=e.call(this)||this;return t._instance=n,n.skinName="resource/skins/GameLobby.exml",n}return __extends(t,e),t.GetInstance=function(){return t._instance},t.prototype.Start=function(){this.once(egret.TouchEvent.TOUCH_TAP,this.GameBeginHandler,this),egret.Tween.get(this.promptTitle,{loop:!0}).to({alpha:.5},1e3).to({alpha:1},1e3),egret.Tween.get(this.leaf1,{loop:!0}).to({x:640,y:400},2200,egret.Ease.quadIn).wait(1e3),egret.Tween.get(this.leaf2,{loop:!0}).to({x:640,y:500},3e3,egret.Ease.quadIn).wait(1e3),egret.Tween.get(this.leaf3,{loop:!0}).to({x:640,y:550},2500,egret.Ease.quadIn).wait(1e3),egret.Tween.get(this.leaf4,{loop:!0}).to({x:640,y:600},1800,egret.Ease.quadIn).wait(1e3),egret.Tween.get(this.leaf5,{loop:!0}).to({x:640,y:450},2e3,egret.Ease.quadIn).wait(1e3);var e=RES.getRes("grass_json"),t=RES.getRes("grass_png"),n=new egret.MovieClipDataFactory(e,t);this.mc1=new egret.MovieClip(n.generateMovieClipData("grass")),this.mc1.width=this.stage.stageWidth,this.mc1.x=-10,this.mc1.y=this.stage.stageHeight-this.mc1.height,this.addChild(this.mc1),this.mc1.gotoAndPlay(1,-1)},t.prototype.GameBeginHandler=function(){this.mc1.stop(),egret.Tween.removeTweens(this.promptTitle),egret.Tween.removeTweens(this.leaf1),egret.Tween.removeTweens(this.leaf2),egret.Tween.removeTweens(this.leaf3),egret.Tween.removeTweens(this.leaf4),egret.Tween.removeTweens(this.leaf5),GameManager.GetInstance().ChangeScene(MyDefine.enSceneType.enScene_Game)},t.prototype.End=function(){},t}(eui.Component);__reflect(GameLobby.prototype,"GameLobby");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){},t.prototype.onProgress=function(e,t){},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[4,platform.login()];case 2:return t.sent(),[4,platform.getUserInfo()];case 3:return e=t.sent(),console.log(e),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return n.sent(),this.stage.removeChild(e),[3,5];case 4:return t=n.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var r=new eui.Theme("resource/default.thm.json",e.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){var e=new GameManager;this.addChild(e),e.start()},t}(eui.UILayer);__reflect(Main.prototype,"Main");var MyDefine;!function(e){var t;!function(e){e[e.enScene_Lobby=0]="enScene_Lobby",e[e.enScene_Game=1]="enScene_Game",e[e.enScene_Result=2]="enScene_Result"}(t=e.enSceneType||(e.enSceneType={}));var n;!function(e){e[e.enTouch_Undo=0]="enTouch_Undo",e[e.enTouch_Touching=1]="enTouch_Touching",e[e.enTouch_End=2]="enTouch_End"}(n=e.enTouchState||(e.enTouchState={}));var r;!function(e){e[e.enType_yellow=0]="enType_yellow",e[e.enType_red=1]="enType_red",e[e.enType_green=2]="enType_green"}(r=e.enLeafType||(e.enLeafType={}))}(MyDefine||(MyDefine={}));var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,r){function s(e){t.call(r,e)}function a(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),n.call(r))}var i=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(r,generateEUI2)},i)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var o=e.split("/");o.pop();var h=o.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(r,generateJSON.paths[e])},this):RES.getResByUrl(h,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(r,generateJSON.paths[e])},i)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);